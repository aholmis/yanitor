@namespace Yanitor.Web.Components.Layout
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<UserMenu> L

<nav class="user-menu" aria-label="User menu">
    <div class="user-menu__trigger" aria-label="@UserEmail">
        @DisplayEmail
    </div>

    <ul class="user-menu__dropdown" role="menu">
        <li class="user-menu__dropdown-item">
            <a href="@NotificationSettingsUrl" class="user-menu__dropdown-link" role="menuitem">
                @L["NotificationSettings"]
            </a>
        </li>
        <li class="user-menu__dropdown-item">
            <form method="post" action="/api/auth/sign-out" class="user-menu__dropdown-form" role="none">
                <input type="hidden" name="__RequestVerificationToken" value="@AntiForgeryToken" />
                <button type="submit" class="user-menu__dropdown-button" role="menuitem">
                    @L["SignOut"]
                </button>
            </form>
        </li>
    </ul>
</nav>

@code {
    /// <summary>
    /// The current user's email, displayed as the dropdown toggle.
    /// </summary>
    [Parameter, EditorRequired]
    public string UserEmail { get; set; } = string.Empty;

    /// <summary>
    /// Antiforgery token to include in the sign-out POST.
    /// </summary>
    [Parameter]
    public string? AntiForgeryToken { get; set; }

    /// <summary>
    /// URL for the notification settings page.
    /// </summary>
    [Parameter]
    public string NotificationSettingsUrl { get; set; } = "/notification-settings";

    private string DisplayEmail
        => string.IsNullOrWhiteSpace(UserEmail)
            ? string.Empty
            : UserEmail[..Math.Min(UserEmail.Length, 30)] + (UserEmail.Length > 30 ? "..." : string.Empty);
}
